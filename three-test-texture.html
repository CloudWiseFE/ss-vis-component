<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Three Cubes Test</title>

    <style>
        body{padding:0px; margin:0px;}
    </style>
</head>
<body>

    <script src='javascripts/jquery.min.js'></script>
    <script src='javascripts/three.min.js'></script>
    <script src='javascripts/TrackballControls.js'></script>
    <script src="javascripts/Detector.js"></script>
    <script src="javascripts/stats.min.js"></script>

    <!-- Script for creating cubes in the space-->
    <script>
        if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

        var SCREEN_WIDTH = window.innerWidth;
        var SCREEN_HEIGHT = window.innerHeight;

        var container,stats;

        var camera, scene, controls, renderer;

        init();
        animate();
        
        function init() {

            container = document.createElement( 'div' );
            document.body.appendChild( container );

            renderer = new THREE.WebGLRenderer( { antialias: true } );

            //

            camera = new THREE.PerspectiveCamera( 45, SCREEN_WIDTH / SCREEN_HEIGHT, 1, 25000 );
            camera.position.z = 4800;

            scene = new THREE.Scene();

            scene.fog = new THREE.Fog( 0x000000, 0.002, 25000 );

            scene.add( new THREE.AmbientLight( 0xeef0ff ) );

            var light = new THREE.DirectionalLight( 0xffffff, 2 );
            light.position.set( 1, 1, 1 );
            scene.add( light );

            // GROUND

            var maxAnisotropy = renderer.getMaxAnisotropy();

            var texture = THREE.ImageUtils.loadTexture( "img/TextureMap.png" );
            var material = new THREE.MeshPhongMaterial( { color: 0x666666, map: texture } );

            texture.anisotropy = maxAnisotropy;
            texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
//            texture.repeat.set( 512, 512 );

            var geometry1 = new THREE.PlaneBufferGeometry( 200, 100 );

            var mesh = new THREE.Mesh( geometry1, material );
            mesh.rotation.x = - Math.PI / 4;
            mesh.rotation.z = 0;
            mesh.scale.set( 25, 25, 25 );

            //Particles

            var particles = 500;

            var geometry = new THREE.BufferGeometry();

            var positions = new Float32Array( particles * 3 );
            var colors = new Float32Array( particles * 3 );

            var color = new THREE.Color();

            var n = 200, n2 = n / 2; // particles spread in the cube

            for ( var i = 0; i < positions.length; i += 3 ) {

                // positions

                var x = Math.random() * n - n2;
                var y = (Math.random() * n - n2) / 2;
                var z = 50;

                positions[ i ]     = x;
                positions[ i + 1 ] = y;
                positions[ i + 2 ] = z;

                // colors

                var vx = ( x / n ) + 0.5;
                var vy = ( y / n ) + 0.5;
                var vz = 0.5;

                color.setRGB( vx, vy, vz );

                colors[ i ]     = color.r;
                colors[ i + 1 ] = color.g;
                colors[ i + 2 ] = color.b;

            }

            geometry.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );
            geometry.addAttribute( 'color', new THREE.BufferAttribute( colors, 3 ) );

            geometry.computeBoundingSphere();

            //

            var material = new THREE.PointCloudMaterial( { size: 50, vertexColors: THREE.VertexColors } );

            particleSystem = new THREE.PointCloud( geometry, material );

            particleSystem.rotation.x = - Math.PI / 4;
            particleSystem.scale.set( 25, 25, 25 );

            scene.add( particleSystem );


            scene.add( mesh );

            object = new THREE.AxisHelper( 500 );
            object.position.set( 0, 0, 0 );
            scene.add( object );

            //controls

            controls = new THREE.TrackballControls( camera );

            controls.rotateSpeed = 1.0;
            controls.zoomSpeed = 1.2;
            controls.panSpeed = 0.8;

            controls.noZoom = false;
            controls.noPan = false;

            controls.staticMoving = true;
            controls.dynamicDampingFactor = 0.3;

            controls.keys = [ 65, 83, 68 ];

            controls.addEventListener( 'change', render );

            // RENDERER

            renderer.setClearColor( scene.fog.color );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( SCREEN_WIDTH, SCREEN_HEIGHT );
            renderer.autoClear = false;

            renderer.domElement.style.position = "relative";
            container.appendChild( renderer.domElement );

            // STATS1

            stats = new Stats();

            // align top-left
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.left = '0px';
            stats.domElement.style.top = '0px';

            document.body.appendChild( stats.domElement );
        }


        function animate() {

            requestAnimationFrame( animate );
            controls.update();

            render();
            stats.update();

        }

        function render() {
            renderer.enableScissorTest( false );
            renderer.clear();
            renderer.enableScissorTest( true );

            renderer.setScissor( 0, 0, SCREEN_WIDTH, SCREEN_HEIGHT );
            renderer.render( scene, camera );
        }
    </script>
</body>
</html>